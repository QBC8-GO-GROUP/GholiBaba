# Base image for Go
FROM golang:alpine

LABEL maintainer="GholiBaba"

# Install necessary tools including Delve
RUN apk add --no-cache git bash gcc musl-dev && \
    go install github.com/go-delve/delve/cmd/dlv@latest

RUN mkdir /app
WORKDIR /app

# Copy application files
COPY . .
COPY ../ .
# Setup Go environment
RUN go env -w GO111MODULE=on
RUN go env -w GOPROXY=https://goproxy.cn,direct

COPY ../go.mod .
COPY ../go.sum .

RUN go mod download
# Expose ports for the app and delve
EXPOSE 8080 40000

# Use Delve to run the application in debug mode
CMD ["go", "run", "--config", "/app/sample-config.json"]